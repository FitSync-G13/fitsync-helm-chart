# Global settings
global:
  environment: development

# Configuration for the Redis subchart
redis:
  enabled: true
  auth:
    enabled: false # Disabling auth for simpler dev setup (as per docker-compose)
  master:
    persistence:
      enabled: false # Keep it ephemeral for dev
  image:
    tag: latest

# Secrets (In production, inject these via CI/CD or Vault)
secrets:
  jwtSecret: "super-secret-jwt-key-change-in-production"
  jwtRefreshSecret: "super-secret-refresh-key-change-in-production"

# New Gateway API Configuration
gateway:
  enabled: true
  name: fitsync-gateway
  # class name depends on infra setup. Standard Istio uses "istio".
  className: istio 
  domain: fitsync.local
  
  # Define Routes
  routes:
    - name: api-route
      path: /api
      service: api-gateway
      port: 4000
    - name: frontend-route
      path: /
      service: frontend
      port: 3000

# Istio Configuration
istio:
  enabled: true
  injection: enabled # Enables sidecar proxies for mTLS

# Service Definitions
services:
  user-service:
    image: fitsync/user-service:latest
    replicaCount: 1
    containerPort: 3001
    env:
      PORT: "3001"
      DB_HOST: "userdb" 
      DB_PORT: "5432"
      DB_NAME: "userdb"
      DB_USER: "fitsync"
      REDIS_HOST: "fitsync-chart-redis-master" # Name generated by the subchart
      REDIS_PORT: "6379"
      JWT_EXPIRY: "15m"
      JWT_REFRESH_EXPIRY: "7d"
    healthCheckPath: "/health"

  training-service:
    image: fitsync/training-service:latest
    replicaCount: 1
    containerPort: 3002
    env:
      PORT: "3002"
      DB_HOST: "trainingdb"
      DB_NAME: "trainingdb"
      DB_USER: "fitsync"
      REDIS_HOST: "fitsync-chart-redis-master"
      USER_SERVICE_URL: "http://user-service:3001"
    healthCheckPath: "/health"

  schedule-service:
    image: fitsync/schedule-service:latest
    replicaCount: 1
    containerPort: 8003
    env:
      PORT: "8003"
      DB_HOST: "scheduledb"
      DB_NAME: "scheduledb"
      DB_USER: "fitsync"
      REDIS_HOST: "fitsync-chart-redis-master"
      USER_SERVICE_URL: "http://user-service:3001"
    healthCheckPath: "/health"

  progress-service:
    image: fitsync/progress-service:latest
    replicaCount: 1
    containerPort: 8004
    env:
      PORT: "8004"
      DB_HOST: "progressdb"
      DB_NAME: "progressdb"
      DB_USER: "fitsync"
      REDIS_HOST: "fitsync-chart-redis-master"
      USER_SERVICE_URL: "http://user-service:3001"
    healthCheckPath: "/health"

  notification-service:
    image: fitsync/notification-service:latest
    replicaCount: 1
    containerPort: 3005
    env:
      PORT: "3005"
      REDIS_HOST: "fitsync-chart-redis-master"
      USER_SERVICE_URL: "http://user-service:3001"
      SMTP_HOST: "smtp.gmail.com"
      SMTP_PORT: "587"
    healthCheckPath: "/health"

  api-gateway:
    image: fitsync/api-gateway:latest
    replicaCount: 1
    containerPort: 4000
    env:
      PORT: "4000"
      REDIS_HOST: "fitsync-chart-redis-master"
      RATE_LIMIT_WINDOW_MS: "900000"
      RATE_LIMIT_MAX_REQUESTS: "100"
      USER_SERVICE_URL: "http://user-service:3001"
      TRAINING_SERVICE_URL: "http://training-service:3002"
      SCHEDULE_SERVICE_URL: "http://schedule-service:8003"
      PROGRESS_SERVICE_URL: "http://progress-service:8004"
      NOTIFICATION_SERVICE_URL: "http://notification-service:3005"
    healthCheckPath: "/health"

  frontend:
    image: fitsync/frontend:latest
    replicaCount: 1
    containerPort: 3000
    env:
      REACT_APP_API_URL: "http://fitsync.local/api"
      REACT_APP_WS_URL: "ws://fitsync.local"

# Local Development Databases
# Docker-compose uses 4 distinct DB containers. 
# Replicating that here for the k8s dev environment.
devDatabases:
  enabled: true
  postgresImage: "postgres:15-alpine"
  auth:
    username: "fitsync"
    password: "fitsync123"